<?php defined('SYSPATH') or die();?> <!doctype html> <html> <head> <meta charset="utf-8"> <title><?php if($is_all) { ?>邮轮旅游_邮轮航线大全_邮轮特价-<?php echo $GLOBALS['cfg_webname'];?><?php } else { ?><?php echo $searchtitle;?><?php } ?> </title> <?php echo $destinfo['keyword'];?> <?php echo $destinfo['description'];?> <?php echo  Stourweb_View::template("pub/varname");  ?> <?php echo Common::css('base.css,extend.css');?> <?php echo Common::css_plugin('ship.css','ship',0);?> <?php echo Common::js('jquery.min.js,base.js,common.js,delayLoading.min.js');?> </head> <body> <?php echo Request::factory("pub/header")->execute()->body(); ?> <div class="big"> <div class="wm-1200"> <div class="st-guide"> <?php require_once ("E:/wamp64/www/taglib/position.php");$position_tag = new Taglib_Position();if (method_exists($position_tag, 'list_crumbs')) {$data = $position_tag->list_crumbs(array('action'=>'list_crumbs','destid'=>$destinfo['dest_id'],'typeid'=>$typeid,));}?> </div><!-- 面包屑 --> <div class="st-main-page"> <div class="ship-content"> <div class="seo-content-box"> <h3 class="seo-bar"><span class="seo-title"><?php if($destinfo['dest_name']) { ?><?php echo $destinfo['dest_name'];?><?php echo $channelname;?><?php } else { ?><?php echo $channelname;?><?php } ?> </span></h3> <?php if($destinfo['dest_jieshao']) { ?> <div class="seo-wrapper clearfix"> <?php echo $destinfo['dest_jieshao'];?> </div> <?php } ?> </div> <!-- 目的地优化设置 --> <div class="st-list-search"> <div class="been-tj"> <strong>已选条件：</strong> <p> <?php $n=1; if(is_array($chooseitem)) { foreach($chooseitem as $item) { ?> <span class="chooseitem" data-url="<?php echo $item['url'];?>"><?php echo $item['itemname'];?><i></i></span> <?php $n++;}unset($n); } ?> <a href="javascript:;" class="clearc">清空筛选条件 </a> </p> </div> <div class="line-search-tj"> <dl class="type"> <dt>目的地：</dt> <dd> <p> <?php require_once ("E:/wamp64/www/taglib/dest.php");$dest_tag = new Taglib_Dest();if (method_exists($dest_tag, 'query')) {$destlist = $dest_tag->query(array('action'=>'query','typeid'=>$typeid,'flag'=>'nextsame','row'=>'100','pid'=>$destid,'return'=>'destlist',));}?> <?php $n=1; if(is_array($destlist)) { foreach($destlist as $dest) { ?> <a <?php if($param['destpy']==$dest['pinyin']) { ?>class="on"<?php } ?>
 href="<?php echo Model_Ship_Line::get_search_url($dest['pinyin'],'destpy',$param);?>"><?php echo $dest['kindname'];?></a> <?php $n++;}unset($n); } ?> </p> <?php if(count($destlist)>10) { ?> <em><b>收起</b><i class='up'></i></em> <?php } ?> </dd> </dl> <dl class="type"> <dt>航线出发地：</dt> <dd> <p> <?php require_once ("E:/wamp64/www/taglib/startplace.php");$startplace_tag = new Taglib_Startplace();if (method_exists($startplace_tag, 'city')) {$startcitylist = $startplace_tag->city(array('action'=>'city','row'=>'100','return'=>'startcitylist',));}?> <?php $n=1; if(is_array($startcitylist)) { foreach($startcitylist as $city) { ?> <a <?php if($param['startcityid']==$city['id']) { ?>class="on"<?php } ?>
 href="<?php echo Model_Ship_Line::get_search_url($city['id'],'startcityid',$param);?>"><?php echo $city['title'];?></a> <?php $n++;}unset($n); } ?> </p> <?php if(count($startcitylist)>10) { ?> <em><b>收起</b><i class='up'></i></em> <?php } ?> </dd> </dl> <dl class="type"> <dt>轮船：</dt> <dd> <p> <?php $ship_tag = new Taglib_Ship();if (method_exists($ship_tag, 'ship')) {$shiplist = $ship_tag->ship(array('action'=>'ship','flag'=>'order','row'=>'100','return'=>'shiplist',));}?> <?php $n=1; if(is_array($shiplist)) { foreach($shiplist as $ship) { ?> <a <?php if($param['shipid']==$ship['id']) { ?>class="on"<?php } ?>
 href="<?php echo Model_Ship_Line::get_search_url($ship['id'],'shipid',$param);?>"><?php echo $ship['title'];?></a> <?php $n++;}unset($n); } ?> </p> </dd> </dl> <dl class="type"> <dt>航线天数：</dt> <dd> <p> <?php $ship_tag = new Taglib_Ship();if (method_exists($ship_tag, 'day_list')) {$data = $ship_tag->day_list(array('action'=>'day_list',));}?> <?php $n=1; if(is_array($data)) { foreach($data as $r) { ?> <a <?php if($param['dayid']==$r['number']) { ?>class="on"<?php } ?>
 href="<?php echo Model_Ship_Line::get_search_url($r['number'],'dayid',$param);?>"><?php echo $r['title'];?></a> <?php $n++;}unset($n); } ?> </p> </dd> </dl> <dl class="type"> <dt>航线价格：</dt> <dd> <p> <?php $ship_tag = new Taglib_Ship();if (method_exists($ship_tag, 'price_list')) {$data = $ship_tag->price_list(array('action'=>'price_list',));}?> <?php $n=1; if(is_array($data)) { foreach($data as $r) { ?> <a <?php if($param['priceid']==$r['id']) { ?>class="on"<?php } ?>
 href="<?php echo Model_Ship_Line::get_search_url($r['id'],'priceid',$param);?>"><?php echo $r['title'];?></a> <?php $n++;}unset($n); } ?> </p> </dd> </dl> <?php require_once ("E:/wamp64/www/taglib/attr.php");$attr_tag = new Taglib_Attr();if (method_exists($attr_tag, 'query')) {$grouplist = $attr_tag->query(array('action'=>'query','flag'=>'grouplist','typeid'=>$typeid,'return'=>'grouplist',));}?> <?php $n=1; if(is_array($grouplist)) { foreach($grouplist as $group) { ?> <dl class="type"> <dt><?php echo $group['attrname'];?>：</dt> <dd> <p> <?php require_once ("E:/wamp64/www/taglib/attr.php");$attr_tag = new Taglib_Attr();if (method_exists($attr_tag, 'query')) {$attrlist = $attr_tag->query(array('action'=>'query','flag'=>'childitem','typeid'=>$typeid,'groupid'=>$group['id'],'return'=>'attrlist',));}?> <?php $n=1; if(is_array($attrlist)) { foreach($attrlist as $attr) { ?> <a href="<?php echo Model_Ship_Line::get_search_url($attr['id'],'attrid',$param);?>" <?php if(Common::check_in_attr($param['attrid'],$attr['id'])!==false) { ?>class="on"<?php } ?>
><?php echo $attr['attrname'];?></a> <?php $n++;}unset($n); } ?> </p> </dd> </dl> <?php $n++;}unset($n); } ?> </div> </div><!-- 条件搜索 --> <div class="st-sort-menu"> <span class="sort-sum"> <a href="javascript:;">综合排序</a> <a href="javascript:;">价格
                                    <?php if($param['sorttype']!=1 && $param['sorttype']!=2) { ?> <i class="jg-default" data-url="<?php echo Model_Ship_Line::get_search_url(1,'sorttype',$param);?>"></i> <?php } ?> <?php if($param['sorttype']==1) { ?> <i class="jg-up" data-url="<?php echo Model_Ship_Line::get_search_url(2,'sorttype',$param);?>"></i> <?php } ?> <?php if($param['sorttype']==2) { ?> <i class="jg-down" data-url="<?php echo Model_Ship_Line::get_search_url(0,'sorttype',$param);?>"></i></a> <?php } ?> <a href="javascript:;">销量
                                    <?php if($param['sorttype']!=3) { ?> <i class="xl-default" data-url="<?php echo Model_Ship_Line::get_search_url(3,'sorttype',$param);?>"></i> <?php } ?> <?php if($param['sorttype']==3) { ?> <i class="xl-down" data-url="<?php echo Model_Ship_Line::get_search_url(0,'sorttype',$param);?>"></i> <?php } ?> </a> <a href="javascript:;">推荐
                                    <?php if($param['sorttype']!=4) { ?> <i class="tj-default" data-url="<?php echo Model_Ship_Line::get_search_url(4,'sorttype',$param);?>"></i> <?php } ?> <?php if($param['sorttype']==4) { ?> <i class="tj-down" data-url="<?php echo Model_Ship_Line::get_search_url(0,'sorttype',$param);?>"></i> <?php } ?> </a> </span> </div><!-- 排序搜索 --> <div class="ship-list-content"> <?php if(!empty($list)) { ?> <ul> <?php $n=1; if(is_array($list)) { foreach($list as $line) { ?> <li> <div class="pic"><a href="<?php echo $line['url'];?>" target="_blank" title="<?php echo $line['title'];?>"><img src="<?php echo Product::get_lazy_img();?>" st-src="<?php echo Common::img($line['litpic'],265,180);?>" alt="<?php echo $line['title'];?>"/></a></div> <div class="txt"> <p class="bt"><a href="<?php echo $line['url'];?>" title="<?php echo $line['title'];?>"><?php echo Common::cutstr_html($line['title'],50);?> <?php $n=1; if(is_array($line['iconlist'])) { foreach($line['iconlist'] as $icon) { ?> <img src="<?php echo $icon['litpic'];?>" /> <?php $n++;}unset($n); } ?> </a> </p> <p class="data"> <span>销量：<?php echo $line['sellnum'];?></span><s>|</s> <span>满意度：<?php echo $line['score'];?></span><s>|</s> <span>推荐：<?php echo $line['recommendnum'];?></span> </p> <p class="xc"><strong>行程概括：</strong><span><?php echo implode('-',$line['passed_destnames']);?></span></p> <p class="ts"> <?php 
                                           $attr_names=array();
                                           foreach($line['attrlist'] as $attr)
                                           {
                                                $attr_names[] = $attr['attrname'];
                                           }
                                           $attr_str = implode(',',$attr_names);
                                        ?> <?php if(!empty($line['sellpoint']) || !empty($line['attrlist'])) { ?> <strong>特色</strong> <span><?php if(!empty($line['sellpoint'])) { ?><?php echo Common::cutstr_html($line['sellpoint'],60);?><?php } else { ?> <?php echo $attr_str;?> <?php } ?> </span> <?php } ?> </p> <p class="msg"> <span class="start"> <?php if(!empty($line['startcity_name'])) { ?>
                                              [<?php echo $line['startcity_name'];?>出发]
                                          <?php } ?> </span> <span class="date"><strong>出发日期：</strong><?php echo $line['starttime'];?></span> </p> </div> <div class="booking"> <span class="yh"> <?php if(!empty($line['price'])) { ?> <i class="currency_sy"><?php echo Currency_Tool::symbol();?></i><b><?php echo $line['price'];?></b>起/人
                                    <?php } else { ?> <b>电询</b> <?php } ?> </span> <span class="yj"><?php if(!empty($line['storeprice'])) { ?>原价：<del><i class="currency_sy"><?php echo Currency_Tool::symbol();?></i><?php echo $line['storeprice'];?>起/人</del><?php } ?> </span> <a href="<?php echo $line['url'];?>" title="<?php echo $line['title'];?>" target="_blank">立即预订</a> </div> </li> <?php $n++;}unset($n); } ?> </ul> <?php } else { ?> <div class="no-content"> <p><i></i>抱歉，没有找到符合条件的产品！<a href="/ship/all">查看全部产品</a></p> </div> <?php } ?> </div><!-- 产品列表 --> <div class="main_mod_page clear"> <?php echo $pageinfo;?> </div> </div><!-- 主体内容 --> <div class="st-sidebox"> <?php require_once ("E:/wamp64/www/taglib/right.php");$right_tag = new Taglib_Right();if (method_exists($right_tag, 'get')) {$data = $right_tag->get(array('action'=>'get','typeid'=>$typeid,'data'=>$templetdata,'pagename'=>'search',));}?> </div><!-- 右侧自定义内容 --> </div> </div> </div> <?php echo Request::factory("pub/footer")->execute()->body(); ?> <?php echo Request::factory("pub/flink")->execute()->body(); ?> <script>
        $(function(){
            //排序方式点击
            $('.sort-sum').find('a').click(function(){
                var url = $(this).find('i').attr('data-url');
                if(url==undefined){
                    url = location.href;
                }
                window.location.href = url;
            })
            //删除已选
            $(".chooseitem").find('i').click(function(){
                var url = $(this).parent().attr('data-url');
                window.location.href = url;
            })
            //清空筛选条件
            $('.clearc').click(function(){
                var url = SITEURL+'ship/all/';
                window.location.href = url;
            })
            //隐藏没有属性下级分类
            $(".type").each(function(i,obj){
                var len = $(obj).find('dd p a').length;
                if(len<1){
                    $(obj).hide();
                }
            })
            //线路搜索条件去掉最后一条边框
            $('.line-search-tj').find('dl').last().addClass('bor_0')
            $(".line-search-tj dl dd em").toggle(function(){
                $(this).prev().height('24px');
                $(this).children('b').text('展开');
                $(this).children('i').addClass('up')
            },function(){
                $(this).prev().height('auto');
                $(this).children('b').text('收起');
                $(this).children('i').removeClass('up')
            });
        })
    </script> </body> </html>
